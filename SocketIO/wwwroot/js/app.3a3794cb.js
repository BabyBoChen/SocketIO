(function(e){function t(t){for(var s,u,a=t[0],o=t[1],i=t[2],d=0,g=[];d<a.length;d++)u=a[d],Object.prototype.hasOwnProperty.call(r,u)&&r[u]&&g.push(r[u][0]),r[u]=0;for(s in o)Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s]);l&&l(t);while(g.length)g.shift()();return c.push.apply(c,i||[]),n()}function n(){for(var e,t=0;t<c.length;t++){for(var n=c[t],s=!0,a=1;a<n.length;a++){var o=n[a];0!==r[o]&&(s=!1)}s&&(c.splice(t--,1),e=u(u.s=n[0]))}return e}var s={},r={app:0},c=[];function u(t){if(s[t])return s[t].exports;var n=s[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,u),n.l=!0,n.exports}u.m=e,u.c=s,u.d=function(e,t,n){u.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},u.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},u.t=function(e,t){if(1&t&&(e=u(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(u.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)u.d(n,s,function(t){return e[t]}.bind(null,s));return n},u.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return u.d(t,"a",t),t},u.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},u.p="/";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],o=a.push.bind(a);a.push=t,a=a.slice();for(var i=0;i<a.length;i++)t(a[i]);var l=o;c.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"22aa":function(e,t,n){},"3ca3":function(e,t,n){"use strict";n("4637")},4637:function(e,t,n){},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var s=n("7a23");function r(e,t){var n=Object(s["y"])("router-view");return Object(s["r"])(),Object(s["d"])(n)}var c=n("6b0d"),u=n.n(c);const a={},o=u()(a,[["render",r]]);var i=o,l=n("6c02"),d=function(e){return Object(s["u"])("data-v-f7002c12"),e=e(),Object(s["s"])(),e},g={class:"wrapper"},f=d((function(){return Object(s["g"])("img",{src:"flask-logo.png"},null,-1)})),p=d((function(){return Object(s["g"])("h1",null,"登入聊天室",-1)})),b=d((function(){return Object(s["g"])("label",null,"暱稱：",-1)})),m=d((function(){return Object(s["g"])("input",{type:"text",name:"guestName",placeholder:"請輸入您的暱稱(上限20個英數或中文字)",required:"",pattern:"^[ 0-9A-Za-z\\u3000\\u3400-\\u4DBF\\u4E00-\\u9FFF]{1,20}$"},null,-1)})),h=d((function(){return Object(s["g"])("br",null,null,-1)})),v=d((function(){return Object(s["g"])("label",null,"通關密語：",-1)})),O=d((function(){return Object(s["g"])("input",{type:"password",name:"password",placeholder:"請輸入通關密語",required:""},null,-1)})),j=d((function(){return Object(s["g"])("br",null,null,-1)})),y=d((function(){return Object(s["g"])("button",{type:"reset",class:"btn btn-warning"},"重填",-1)}));function $(e,t,n,r,c,u){return Object(s["r"])(),Object(s["f"])("div",g,[Object(s["g"])("form",{ref:"frmLogin",onSubmit:t[1]||(t[1]=Object(s["F"])((function(){}),["prevent"]))},[f,p,b,m,h,v,O,j,Object(s["g"])("button",{type:"submit",class:"btn btn-success",onClick:t[0]||(t[0]=function(e){return u.login()})},"登入"),y],544)])}var k=n("1da1"),I=(n("96cf"),n("d3b7"),""),w={login:I+"login",verify:I+"verify",chatHub:I+"chatHub"},S={name:"Home",methods:{login:function(){var e=this;return Object(k["a"])(regeneratorRuntime.mark((function t(){var n,s,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.$refs.frmLogin,!n.checkValidity()){t.next=7;break}return s=new FormData(n),t.next=5,fetch(w.login,{method:"POST",body:s}).then((function(e){return e.json()})).then((function(e){return console.log(e),e["isLogin"]})).catch((function(e){return console.log(e),!1}));case 5:r=t.sent,r?e.$router.push("/chatroom"):alert("請輸入正確的通關密語!");case 7:case"end":return t.stop()}}),t)})))()}}};n("3ca3");const x=u()(S,[["render",$],["__scopeId","data-v-f7002c12"]]);var N=x,C={ref:"messageWrapper",class:"message-wrapper"};function L(e,t,n,r,c,u){var a=Object(s["y"])("GuestList"),o=Object(s["y"])("Message"),i=Object(s["y"])("InputBox");return Object(s["r"])(),Object(s["f"])(s["a"],null,[Object(s["i"])(a,{ref:"guestList",onGuestClicked:u.guestClicked},null,8,["onGuestClicked"]),Object(s["g"])("div",C,[(Object(s["r"])(!0),Object(s["f"])(s["a"],null,Object(s["x"])(e.messages,(function(e){return Object(s["r"])(),Object(s["d"])(o,{key:e.sendTime,"guest-id":e.guestId,"guest-name":e.guestName,message:e.message,receiverId:e.receiverId,receiverName:e.receiverName,"msg-type":e.msgType},null,8,["guest-id","guest-name","message","receiverId","receiverName","msg-type"])})),128))],512),Object(s["i"])(i,{class:"inputbox",onSubmit:u.onSend,"place-holder":this.$data.guestName},null,8,["onSubmit","place-holder"])],64)}n("a434"),n("159b"),n("25f0");var T=function(e){return Object(s["u"])("data-v-2f3bc836"),e=e(),Object(s["s"])(),e},_={class:"guestlist-toggler","data-bs-toggle":"collapse",href:"#guestList",role:"button","aria-expanded":"false","aria-controls":"guestList"},G=T((function(){return Object(s["g"])("i",{class:"fas fa-user green"},null,-1)})),P=Object(s["h"])(" 在線訪客 "),H=T((function(){return Object(s["g"])("i",{class:"fas fa-angle-double-down"},null,-1)})),A={ref:"guestList",class:"collapse guestList",id:"guestList"};function E(e,t,n,r,c,u){var a=Object(s["y"])("Guest");return Object(s["r"])(),Object(s["f"])("div",null,[Object(s["g"])("a",_,[G,P,H,Object(s["g"])("span",null,"to: "+Object(s["A"])(this.$data.selectedName),1)]),Object(s["g"])("div",A,[(Object(s["r"])(!0),Object(s["f"])(s["a"],null,Object(s["x"])(e.guests,(function(e){return Object(s["r"])(),Object(s["d"])(a,{onGuestClicked:u.guestClicked,key:e.guestId,"guest-name":e.guestName,"guest-id":e.guestId,"is-selected":e.isSelected},null,8,["onGuestClicked","guest-name","guest-id","is-selected"])})),128))],512)])}var F=function(e){return Object(s["u"])("data-v-2b225310"),e=e(),Object(s["s"])(),e},R=F((function(){return Object(s["g"])("label",{class:"guest-label"},"暱稱：",-1)})),M={class:"guest-name"},B=F((function(){return Object(s["g"])("label",{class:"guest-label"},"連線ID：",-1)})),W={class:"guest-id"};function D(e,t,n,r,c,u){return Object(s["r"])(),Object(s["f"])("div",{ref:"guestWrapper",class:"guestWrapper",onClick:t[0]||(t[0]=function(e){return u.guestClicked()})},[R,Object(s["g"])("div",M,Object(s["A"])(this.$props.guestName),1),B,Object(s["g"])("div",W,Object(s["A"])(this.$props.guestId),1)],512)}var z={name:"Guest",props:{guestName:String,guestId:String,isSelected:Boolean},mounted:function(){if(this.$props.isSelected){var e=this.$refs.guestWrapper;e.style.backgroundColor="rgba(107, 168, 50,0.2)"}},watch:{isSelected:function(e,t){var n=this.$refs.guestWrapper;n.style.backgroundColor=e?"rgba(107, 168, 50,0.2)":""}},data:function(){var e={};return e},methods:{guestClicked:function(){this.$emit("guestClicked",this.$props.guestId,this.$props.guestName)}}};n("8a31");const U=u()(z,[["render",D],["__scopeId","data-v-2b225310"]]);var q=U,J={name:"GuessList",components:{Guest:q},data:function(){var e={selectedId:"-",selectedName:"所有人",guests:[{guestId:"-",guestName:"所有人",isSelected:!0}]};return e},mounted:function(){},methods:{guestClicked:function(e,t){this.$data.selectedName=t,this.$data.selectedId=e,console.log({guestName:t,guestId:e}),this.$emit("guestClicked",e,t),this.$data.guests.forEach((function(t){t.guestId==e?t.isSelected=!0:t.isSelected=!1}));var n=this.$refs.guestList;n.classList.remove("show")},refreshGuestList:function(e){this.$data.guests.splice(0);for(var t=0;t<e.length;t++)this.$data.guests.push(e[t])}}};n("6a8c");const V=u()(J,[["render",E],["__scopeId","data-v-2f3bc836"]]);var Z=V,K={key:0,class:"message"},Q={key:1,class:"notice"};function X(e,t,n,r,c,u){return"message"==this.$props.msgType?(Object(s["r"])(),Object(s["f"])("div",K,[Object(s["g"])("span",null,[Object(s["g"])("b",null,Object(s["A"])(this.$props.guestName),1),Object(s["h"])("對-"+Object(s["A"])(this.$props.receiverName)+"-說: ",1)]),Object(s["g"])("span",null,Object(s["A"])(this.$props.message),1)])):"notice"==this.$props.msgType?(Object(s["r"])(),Object(s["f"])("div",Q,[Object(s["g"])("span",null,Object(s["A"])(this.$props.message),1)])):Object(s["e"])("",!0)}var Y={name:"Message",props:{msgType:String,guestId:String,guestName:String,receiverId:String,receiverName:String,message:String,sendTime:String},data:function(){var e={};return e}};n("81c9");const ee=u()(Y,[["render",X]]);var te=ee,ne=function(e){return Object(s["u"])("data-v-06924528"),e=e(),Object(s["s"])(),e},se={class:"inputbox-wrapper"},re=["placeholder"],ce=ne((function(){return Object(s["g"])("i",{class:"fas fa-paper-plane fa-2x"},null,-1)})),ue=[ce];function ae(e,t,n,r,c,u){var a=this;return Object(s["r"])(),Object(s["f"])("div",se,[Object(s["E"])(Object(s["g"])("textarea",{ref:"txt",onInput:t[0]||(t[0]=function(e){return u.onInput(e.target)}),"onUpdate:modelValue":t[1]||(t[1]=function(e){return a.$data.text=e}),placeholder:this.$props.placeHolder+"說:"},null,40,re),[[s["C"],this.$data.text]]),Object(s["g"])("button",{class:"btn-send",onClick:t[2]||(t[2]=function(e){return u.submit()})},ue)])}var oe={name:"InputBox",props:{placeHolder:String},data:function(){var e={text:""};return e},methods:{onInput:function(e){e.style.height="0rem";var t=this.convertPixelsToRem(e.scrollHeight);e.style.height=t<=3.75?"3.75rem":t>=5.25?"5.25rem":t+"rem"},submit:function(){var e=this.$refs.txt,t=e.value;t&&this.$emit("submit",t),this.$data.text="",e.style.height="3.75rem"},convertRemToPixels:function(e){return e*parseFloat(getComputedStyle(document.documentElement).fontSize)},convertPixelsToRem:function(e){return e/parseFloat(getComputedStyle(document.documentElement).fontSize)}}};n("72bd");const ie=u()(oe,[["render",ae],["__scopeId","data-v-06924528"]]);var le=ie,de={name:"Chatroom",data:function(){var e={socket:null,guestId:"-",guestName:"unknown",selectedId:"-",selectedName:"所有人",messages:[],guests:[{guestId:"-",guestName:"所有人",isSelected:!1}]};return e},components:{InputBox:le,GuestList:Z,Message:te},mounted:function(){var e=this;return Object(k["a"])(regeneratorRuntime.mark((function t(){var n,s,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e,n=e.$data,s=e.$refs.guestList,t.next=5,fetch(w.verify,{method:"GET"}).then((function(e){return e.json()})).then((function(e){return n.guestName=e["guestName"],e["isLogin"]})).catch((function(e){return console.log(e),!1}));case 5:r=t.sent,r?(n.socket=(new signalR.HubConnectionBuilder).withUrl(w.chatHub).build(),n.socket.on("guestList",(function(e){n.guests.splice(0),e["users"].forEach((function(e){n.guests.push(e)})),s.refreshGuestList(n.guests);var t={msgType:"notice",guestId:"",guestName:"",receiverId:"",receiverName:"",message:e["notice"],sendTime:Date.now()};n.messages.push(t)})),n.socket.on("incomming",(function(e){n.messages.push(e)})),n.socket.start().then((function(){console.log("connecting to websocket..."),n.guestId=n.socket.connection.connectionId,window.addEventListener("beforeunload",(function(){try{n.socket.stop()}catch(e){}}))})).catch((function(e){return console.error(e.toString())}))):e.$router.push("/");case 7:case"end":return t.stop()}}),t)})))()},updated:function(){var e=this.$refs.messageWrapper;e.scrollTop=e.scrollHeight},beforeUnmount:function(){try{this.$data.socket.stop()}catch(e){}},methods:{onSend:function(e){var t={msgType:"message",guestId:this.$data.guestId,guestName:this.$data.guestName,message:e,receiverId:this.$data.selectedId,receiverName:this.$data.selectedName,sendTime:Date.now()};this.$data.socket.send("send",t)},guestClicked:function(e,t){this.$data.selectedId=e,this.$data.selectedName=t}}};n("99db");const ge=u()(de,[["render",L],["__scopeId","data-v-7c0e68c8"]]);var fe=ge,pe=[{path:"/",name:"Home",component:N},{path:"/chatroom",name:"Chatroom",component:fe}],be=Object(l["a"])({history:Object(l["b"])(),routes:pe}),me=be;Object(s["c"])(i).use(me).mount("#app")},"6a8c":function(e,t,n){"use strict";n("6dee")},"6dee":function(e,t,n){},"72bd":function(e,t,n){"use strict";n("22aa")},"81c9":function(e,t,n){"use strict";n("d7f4")},"8a31":function(e,t,n){"use strict";n("d635")},"99db":function(e,t,n){"use strict";n("f7ea")},d635:function(e,t,n){},d7f4:function(e,t,n){},f7ea:function(e,t,n){}});
//# sourceMappingURL=app.3a3794cb.js.map